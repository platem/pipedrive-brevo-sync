- [x] **Unit 1: Refactor: Move Filter Loading to Layout**: Created `+layout.server.ts` with Pipedrive filter sync logic (upsert, soft-delete handling), returns `{ filters }` to all (app) routes. Removed redundant `+page.server.ts` from dashboard, added placeholder file for future auth checks. _(Note: Filters from layout are available to child pages via `data.filters` without explicit prop drilling)_

- [x] **Unit 2: Pipedrive Service Extension**: Added `PipedriveDeal` and `PipedrivePerson` types from API docs. Implemented `getDealsByFilter(filterId)` with cursor-based pagination (100/page). Implemented `getPersons(personIds)` with batched lookups (100 IDs per request, no throttling needed). Orchestrator handles deduplication (`[...new Set()]`) and deal-to-person mapping. _(Note: Replaced individual `getPerson()` with batched `getPersons()` for efficiency)_

- [x] **Unit 3: Brevo Service Creation**: Created `src/lib/server/services/brevo.service.ts` with `BrevoContact` type, `createList(name)` → `{ id }`, `emptyList(listId)` using `all: true` param, and `importContacts(listId, contacts)` with 50-batch import. _(Note: Response body must be consumed with `await response.json()` even when unused to prevent connection pool exhaustion and memory leaks)_

- [x] **Unit 4: Route Load: Mode Validation & Job Lock**: Created `src/routes/(app)/[mode]/+page.server.ts` with load function that validates mode param (new/overwrite), returns 404 for invalid modes, and queries `sync_jobs` table for `status = 'processing'` to determine `hasActiveJob`. Returns `{ mode, hasActiveJob }` to page (filters come from layout). _(Note: Simple count check on active jobs is sufficient for lock mechanism)_

- [x] **Unit 5: Sync Action: Validation & Job Creation**: Added `actions` object with `sync` action implementing validation chain (filterIds parsing, job lock double-check, filter eligibility against DB). Creates `sync_job` records with `status: 'processing'` for each filter using try-catch with insert verification. Returns `{ success, totalSent, failedFilters }` response. _(Note: Actions don't have access to layout data - DB read required for server-side validation despite filters being available from layout in page component)_

- [x] **Unit 6: Sync Action: Orchestration Logic**: Implemented full sync orchestration in `+page.server.ts`. For 'new' mode: creates Brevo list using filter name, stores brevo*list_id in DB. For 'overwrite' mode: empties existing Brevo list. Fetches deals via `getDealsByFilter()`, deduplicates person IDs, batch fetches persons via `getPersons()`. Transforms persons to BrevoContact[] (email, FIRSTNAME, LASTNAME, EXT_ID), imports via `importContacts()`. Updates sync_job to completed/failed with totals. Refactored to iterate directly through persons array instead of deals for O(n) contact creation. *(Note: Partial failure handling - continues processing remaining filters on error, returns aggregate result with failedFilters list)\_

- [x] **Unit 7: UI Data Integration**: Updated `+page.svelte` to use real data from `data` prop instead of mock data. Added `eligibleFilters` derived state that filters by mode eligibility (brevoListId null for new, not null for overwrite). Replaced all `mockFilters` and `mockActiveJob` references with real data. Added empty state UI showing "Brak dostępnych filtrów" with back link when no eligible filters exist. Wired `hasActiveJob` to disable checkboxes and button.

- [x] **Unit 8: UI Action Feedback**: Added action feedback UI using SvelteKit's `form` prop pattern. Fixed `PageProps` type declaration to include `params`, `data`, and `form`. Added feedback sections: success message (green "Zsynchronizowano X kontaktów"), partial failure (amber listing failed filters), and error message (red). Updated `handleSubmit()` with proper `ActionResult` type and `await update()` to receive action responses and auto-clear form. _(Note: `await update()` is required to copy action `fail()` or return values into the `form` prop; without it, error/success messages won't display)_
